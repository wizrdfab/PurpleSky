Feature Engine Documentation
============================
This document details the feature set generated by `feature_engine.py`.
These features are designed to capture Price Action, Orderbook Microstructure, Volume Flow, and Multi-Timeframe Regimes.

1. Volatility & Trend (Price Action)
------------------------------------
These features measure the speed and direction of price movement.

*   `atr`: Average True Range (14 periods). Measures absolute volatility in price units.
*   `natr`: Normalized ATR (`atr` / `close`). Measures volatility as a percentage of price. Used for regime detection to be price-agnostic.
*   `dist_ema_9`: Distance of Price from the 9-period EMA, normalized by ATR.
*   `dist_ema_21`: Distance of Price from the 21-period EMA, normalized by ATR.
*   `dist_ema_50`: Distance of Price from the 50-period EMA, normalized by ATR.
*   `ema_9_slope`: Slope of the 9-period EMA (change over 5 bars), normalized by ATR.
*   `ema_21_slope`: Slope of the 21-period EMA, normalized by ATR.
*   `ema_50_slope`: Slope of the 50-period EMA, normalized by ATR.
*   `rsi`: Relative Strength Index (14 periods). Momentum oscillator (0-100).
*   `bb_percent_b`: Bollinger %B. Position of price relative to Bollinger Bands (20, 2). 0 = Lower Band, 1 = Upper Band.

2. Orderbook Microstructure (Liquidity & Pressure)
--------------------------------------------------
These features analyze the limit order book to detect hidden supply/demand and liquidity shifts.

*   `ob_imb_trend`: Rolling average (4 periods) of Orderbook Imbalance.
*   `ob_imbalance_z`: Z-Score of Orderbook Imbalance (relative to last 4 hours). Detects sudden shocks in book pressure.
*   `micro_pressure`: Micro-Price Deviation normalized by ATR. High values indicate the "fair price" (based on liquidity) is far from the last traded price.
*   `micro_dev_vol`: Maker Uncertainty. Standard deviation of micro-price deviation normalized by ATR. High values indicate makers are jittery/adjusting quotes rapidly.
*   `spread_z`: Z-Score of the Spread. Detects if spread is unusually wide (fear) or tight (efficiency).
*   `ob_spread_bps`: Spread cost in Basis Points. Normalized cost of execution.
*   `bid_depth_chg`: Rate of change (pct) in Bid Liquidity.
*   `ask_depth_chg`: Rate of change (pct) in Ask Liquidity.
*   `ob_depth_log_ratio`: Logarithmic ratio of Bid Depth to Ask Depth. Symmetric measure of static pressure.
*   `liq_dominance`: Liquidity Dominance. Ratio of Total Depth to Volume. High = Absorptive walls (Mean Reversion), Low = Fragile walls (Trend).
*   `price_liq_div`: Price-Liquidity Divergence. Sign(Price Change) * Sign(Imbalance Change). Negative values indicate Price is moving *against* Liquidity (potential exhaustion/spoofing).
*   `ob_bid_elasticity`: Elasticity of the Bid side (Slope normalized by Price). Measures how "thick" or "thin" the book is.
*   `ob_ask_elasticity`: Elasticity of the Ask side.
*   `ob_slope_ratio`: Ratio of Bid Elasticity to Ask Elasticity. > 1.0 means Bids are "thin" (steep slope) compared to Asks.
*   `bid_slope_z`: Z-Score of Bid Elasticity. Detects sudden thinning of the buy-side wall.
*   `ob_integrity_skew`: Difference between Bid Integrity and Ask Integrity. High = Strong intent on Bid side.
*   `bid_integrity_chg`: Momentum/Change in Bid Integrity.
*   `ask_integrity_chg`: Momentum/Change in Ask Integrity.

3. Volume & Flow (Activity)
---------------------------
These features analyze executed trades to detect aggression and anomalies.

*   `vol_z`: Volume Z-Score. Detects volume anomalies relative to the last 24 bars.
*   `taker_buy_z`: Z-Score of Taker Buy Ratio. Detects unusual aggressive buying pressure (toxic flow).

4. Inventory Context (VWAP & Regimes)
-------------------------------------
These features provide longer-term context and detect regime shifts (Expansion vs. Compression).

*   `vwap_4h_dist`: Distance of Price from the 4-Hour Volume Weighted Average Price, normalized by ATR. Short-term fair value.
*   `vwap_24h_dist`: Distance of Price from the 24-Hour VWAP, normalized by ATR. Proxy for daily "Cost Basis".
*   `vol_intraday`: Intraday Volume Regime. Ratio of 1H Volume to 24H Volume. Is today active?
*   `vol_macro`: Macro Volume Regime. Ratio of 24H Volume to 30D Volume. Is this week active?
*   `atr_z`: Volatility Z-Score (using NATR). Detects volatility shocks.
*   `atr_regime`: Intraday Volatility Regime. Ratio of 1H NATR to 24H NATR. > 1.0 = Expanding (Trend Risk), < 1.0 = Compressing (Breakout/Reversion).
*   `atr_macro`: Macro Volatility Regime. Ratio of 24H NATR to 30D NATR. Secular trend in market energy.

Data Cleaning Note:
- Features are forward-filled or filled with 0 where appropriate.
- Rows with 0 or NaN prices are dropped to ensure data integrity.
